{% extends "base.html" %}

{% block title %}–°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ ‚Äî Telegram Memory{% endblock %}

{% block content %}
<div class="index-header">
  <h1>{% if current_user.is_admin %}–í—Å–µ —á–∞—Ç—ã{% else %}–ú–æ–∏ —á–∞—Ç—ã{% endif %}</h1>
  <div class="index-header-actions">
    <a href="/import" class="btn">–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —á–∞—Ç</a>
    {% if current_user.is_admin %}
      <a href="/admin/users" class="btn btn-secondary">–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</a>
    {% endif %}
  </div>
</div>

{% if success_msg %}
  <div class="message-success">
    {{ success_msg }}
  </div>
{% endif %}

{% if error_msg %}
  <div class="message-error">
    {{ error_msg }}
  </div>
{% endif %}

<form method="get" action="/" class="search-form">
  <input 
    type="text" 
    name="search" 
    value="{{ search }}" 
    placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é —á–∞—Ç–∞..." 
    class="search-input"
  >
  <button type="submit" class="btn">–ü–æ–∏—Å–∫</button>
  {% if search %}
    <a href="/" class="btn btn-secondary">–°–±—Ä–æ—Å–∏—Ç—å</a>
  {% endif %}
</form>

{% if chats %}
  <ul class="chat-list">
    {% for chat in chats %}
      <li class="chat-list-item">
        <a href="/chats/{{ chat.id }}" class="chat-link">
          <div class="chat-title">
            {{ chat.title }}
            {% if chat.password_hash %}
              üîí
            {% endif %}
            {% if not current_user.is_admin and chat_access_map.get(chat.id) and chat.user_id != current_user.id %}
              <span style="color: #94a3b8; font-size: 12px; margin-left: 8px;">(–î–æ—Å—Ç—É–ø –≤—ã–¥–∞–Ω)</span>
            {% endif %}
          </div>
          <div class="chat-meta">
            {% if chat.created_at %}
              <span>—Å {{ chat.created_at.strftime("%d.%m.%Y") }}</span>
            {% endif %}
            {% if chat.updated_at %}
              <span>–ø–æ {{ chat.updated_at.strftime("%d.%m.%Y") }}</span>
            {% endif %}
            {% if current_user.is_admin %}
              <span style="color: #94a3b8;">‚Äî –í–ª–∞–¥–µ–ª–µ—Ü: {{ chat.owner.username }}</span>
            {% endif %}
          </div>
        </a>
        <div class="chat-actions">
          {% if chat.user_id == current_user.id or current_user.is_admin %}
            <a href="/chats/{{ chat.id }}/edit" class="chat-edit-link">–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å</a>
          {% endif %}
        </div>
      </li>
    {% endfor %}
  </ul>
{% else %}
  <p>–ü–æ–∫–∞ –Ω–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —á–∞—Ç–æ–≤. –ó–∞–π–¥–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É ¬´–ò–º–ø–æ—Ä—Ç —á–∞—Ç–∞¬ª.</p>
{% endif %}
{% endblock %}
