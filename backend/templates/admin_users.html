{% extends "base.html" %}

{% block title %}Управление пользователями — Админ-панель{% endblock %}

{% block content %}
<div class="index-header">
  <h1>Управление пользователями</h1>
  <div style="display: flex; gap: 8px;">
    <a href="/" class="btn">Все чаты</a>
    <a href="/admin/chat-access" class="btn">Управление доступом</a>
  </div>
</div>

{% if request.query_params.get("success") %}
  <div class="message-success">
    {{ request.query_params.get("success") }}
  </div>
{% endif %}

{% if request.query_params.get("error") %}
  <div class="message-error">
    {{ request.query_params.get("error") }}
  </div>
{% endif %}

{% if users %}
  <table style="width: 100%; border-collapse: collapse; margin-top: 16px;">
    <thead>
      <tr style="background: #1e293b; border-bottom: 2px solid #334155;">
        <th style="padding: 12px; text-align: left;">Имя пользователя</th>
        <th style="padding: 12px; text-align: left;">Роль</th>
        <th style="padding: 12px; text-align: left;">Дата регистрации</th>
        <th style="padding: 12px; text-align: left;">Действия</th>
      </tr>
    </thead>
    <tbody>
      {% for user in users %}
        <tr style="border-bottom: 1px solid #334155;">
          <td style="padding: 12px;">
            <strong>{{ user.username }}</strong>
            {% if user.id == current_user.id %}
              <span style="color: #94a3b8;">(Вы)</span>
            {% endif %}
          </td>
          <td style="padding: 12px;">
            {% if user.is_admin %}
              <span style="color: #fbbf24; font-weight: bold;">Администратор</span>
            {% else %}
              <span style="color: #94a3b8;">Пользователь</span>
            {% endif %}
          </td>
          <td style="padding: 12px; color: #94a3b8;">
            {% if user.created_at %}
              {{ user.created_at.strftime("%d.%m.%Y %H:%M") }}
            {% else %}
              —
            {% endif %}
          </td>
          <td style="padding: 12px;">
            <div style="display: flex; gap: 8px;">
              <form method="post" action="/admin/users/{{ user.id }}/toggle_admin" style="margin: 0;">
                <button type="submit" class="btn" style="padding: 4px 12px; font-size: 14px;">
                  {% if user.is_admin %}
                    Снять права админа
                  {% else %}
                    Назначить админом
                  {% endif %}
                </button>
              </form>
              {% if user.id != current_user.id %}
                <form method="post" action="/admin/users/{{ user.id }}/delete" style="margin: 0;" 
                      onsubmit="return confirm('Вы уверены, что хотите удалить пользователя {{ user.username }}?');">
                  <button type="submit" class="btn" style="padding: 4px 12px; font-size: 14px; background: #ef4444;">
                    Удалить
                  </button>
                </form>
              {% endif %}
              <a href="/admin/chat-access?user_id={{ user.id }}" class="btn" style="padding: 4px 12px; font-size: 14px; background: #6366f1;">
                Управление доступом
              </a>
            </div>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>Пользователей не найдено.</p>
{% endif %}
{% endblock %}

